<div class="screenfix">
    <div class="container">
        <div class="auth-box">
            <!-- Shared Header -->
            <div class="site-header">
                <h3>Welcome to <span class="brand-highlight">Grindflow</span></h3>
                <p *ngIf="!isLoginView" class="welcome-sub">Create your account to get started ðŸš€</p>
            </div>

            <!-- Login View -->
            <div *ngIf="isLoginView" class="form-view absolute-form">
                <h2>Login</h2>

                <form #loginFormRef="ngForm" (ngSubmit)="onLoginSubmit(loginFormRef)" novalidate>
                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Email</mat-label>
                        <input matInput type="email" name="email" [(ngModel)]="loginForm.email" #loginEmail="ngModel"
                            required email autocomplete="email" />
                        <mat-error *ngIf="loginEmail.errors?.['required']">Email is required.</mat-error>
                        <mat-error *ngIf="loginEmail.errors?.['email']">Enter a valid email.</mat-error>
                    </mat-form-field>

                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Password</mat-label>
                        <input matInput [type]="showPassword ? 'text' : 'password'" name="password"
                            [(ngModel)]="loginForm.password" #loginPassword="ngModel" required minlength="6"
                            autocomplete="current-password" />
                        <button mat-icon-button matSuffix type="button" (click)="togglePasswordVisibility()">
                            <mat-icon>{{ showPassword ? 'visibility' : 'visibility_off' }}</mat-icon>
                        </button>
                        <mat-error *ngIf="loginPassword.errors?.['required']">Password is required.</mat-error>
                        <mat-error *ngIf="loginPassword.errors?.['minlength']">Min 6 characters required.</mat-error>
                    </mat-form-field>

                    <button mat-raised-button color="primary" class="full-width" type="submit"
                        [disabled]="loading || loginFormRef.invalid">
                        {{ loading ? 'Logging in...' : 'Login' }}
                    </button>
                </form>
            </div>

            <!-- Signup View -->
            <div *ngIf="!isLoginView" class="form-view absolute-form">
                <h2>Sign Up</h2>

                <form #signupFormRef="ngForm" (ngSubmit)="onSignupSubmit(signupFormRef)" novalidate>
                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Full Name</mat-label>
                        <input matInput type="text" name="name" [(ngModel)]="signupForm.name" #signupName="ngModel"
                            required minlength="2" autocomplete="name" />
                        <mat-error *ngIf="signupName.errors?.['required']">Name is required.</mat-error>
                        <mat-error *ngIf="signupName.errors?.['minlength']">At least 2 characters.</mat-error>
                    </mat-form-field>

                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Email</mat-label>
                        <input matInput type="email" name="email" [(ngModel)]="signupForm.email" #signupEmail="ngModel"
                            required email autocomplete="email" />
                        <mat-error *ngIf="signupEmail.errors?.['required']">Email is required.</mat-error>
                        <mat-error *ngIf="signupEmail.errors?.['email']">Enter a valid email.</mat-error>
                    </mat-form-field>

                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Password</mat-label>
                        <input matInput [type]="showPassword ? 'text' : 'password'" name="password"
                            [(ngModel)]="signupForm.password" #signupPassword="ngModel" required
                            pattern="^(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&])[A-Za-z\\d@$!%*?&]{8,}$"
                            (ngModelChange)="checkPasswordStrength($event)" autocomplete="new-password" />
                        <button mat-icon-button matSuffix type="button" (click)="togglePasswordVisibility()">
                            <mat-icon>{{ showPassword ? 'visibility' : 'visibility_off' }}</mat-icon>
                        </button>
                        <mat-error *ngIf="signupPassword.errors?.['required']">Password is required.</mat-error>
                        <mat-error *ngIf="signupPassword.errors?.['pattern']">
                            Must be 8+ chars, 1 uppercase, 1 number & 1 special char.
                        </mat-error>
                    </mat-form-field>

                    <!-- Strength Meter -->
                    <div class="password-strength">
                        <div class="strength-bar" [ngClass]="passwordStrength"></div>
                        <span class="strength-label">{{ passwordStrengthLabel }}</span>
                    </div>

                    <button mat-raised-button color="primary" class="full-width" type="submit"
                        [disabled]="loading || signupFormRef.invalid || !isPasswordStrongEnough">
                        {{ loading ? 'Signing up...' : 'Sign Up' }}
                    </button>
                </form>
            </div>

            <!-- Google Sign-in -->
            <div class="google-section">
                <div id="googleBtn" class="google-btn"></div>
            </div>

            <!-- View Toggle -->
            <div class="toggle-text">
                <span>{{ isLoginView ? "Don't have an account?" : "Already have an account?" }}</span>
                <a role="button" tabindex="0" (click)="toggleView()">
                    {{ isLoginView ? 'Sign up' : 'Login' }}
                </a>
            </div>

            <!-- Message -->
            <p class="message" *ngIf="message">{{ message }}</p>
        </div>
    </div>

    <!-- Email Exists Modal -->
    <ng-template [ngIf]="showEmailExistsModal">
        <div class="modal-backdrop">
            <div class="modal-content">
                <h3>Email already registered</h3>
                <p>Please log in instead.</p>
                <button mat-raised-button color="primary" (click)="closeModal()">OK</button>
            </div>
        </div>
    </ng-template>
</div>